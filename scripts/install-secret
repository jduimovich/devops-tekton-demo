DOCKERHUB_USERNAME=$MY_DOCKER_USER
DOCKERHUB_PASSWORD=$MY_DOCKER_PW

GITHUB_USERNAME=$MY_PUBLIC_GIT_USER
GITHUB_TOKEN=$MY_PUBLIC_GIT_TOKEN
GITHUB_URL=https://github.com

IS_DOCKER_DESKTOP=$(kubectl config current-context)

if [ $IS_DOCKER_DESKTOP == "docker-desktop" ] ; then
DASHBOARD_HOST=http://localhost:9097 
else
DASHBOARD_HOST=https://despond1.fyre.ibm.com
fi

curl -k -s -m 2 $DASHBOARD_HOST > /dev/null
until [ $? -eq 0 ] ; do
    echo Waiting for $DASHBOARD_HOST
    sleep 1
    curl -k -s -m 2 $DASHBOARD_HOST > /dev/null
done


## docker-push secret used to push images to dockerhub
export DASHBOARD_INSTALL_NS=$TEKTON_DEMO_NS
export DASHBOARD_INSTALL_SA=$TEKTON_DEMO_SA

post_data='{
    "name": "dockerhub-user-password",
    "type": "userpass",
    "username": "'"${DOCKERHUB_USERNAME}"'",
    "password": "'"${DOCKERHUB_PASSWORD}"'",
    "url": {"tekton.dev/docker-0": "https://index.docker.io/v1/"},
    "serviceaccount": "'"${DASHBOARD_INSTALL_SA}"'"
}'

kubectl get secrets -n $TEKTON_DEMO_NS | grep dockerhub-user-password  > /dev/null
if [ $? -eq 0 ] ; then
    echo  "docker user and password secret is installed"
else 
    curl -k -X POST --header Content-Type:application/json -d "$post_data" $DASHBOARD_HOST/v1/namespaces/${DASHBOARD_INSTALL_NS}/credentials
    echo 'created dockerhub-user-password  secret' 
fi

post_data='{                                                                                                                      
    "name": "github-user-password",                                                                                          
    "type": "userpass",                                                                                                           
    "username": "'"${GITHUB_USERNAME}"'",                                                                                         
    "password": "'"${GITHUB_TOKEN}"'",                                                                                            
    "url": {"tekton.dev/git-0": "'"${GITHUB_URL}"'"},                                                                             
    "serviceaccount": "'"${DASHBOARD_INSTALL_SA}"'"

}'

kubectl get secrets -n $TEKTON_DEMO_NS | grep github-user-password  > /dev/null
if [ $? -eq 0 ] ; then
    echo  "git user and password secret is installed"
else 
    curl -k -X POST --header Content-Type:application/json -d "$post_data" $DASHBOARD_HOST/v1/namespaces/${DASHBOARD_INSTALL_NS}/\
credentials
    echo 'created github-user-password secret'

fi






